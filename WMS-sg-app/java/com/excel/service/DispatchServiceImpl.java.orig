package com.excel.service;

import java.util.Date;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.excel.bean.DispatchBean;
import com.excel.model.AllocationDetailList;
import com.excel.model.Am_m_System_Parameter;
import com.excel.model.AutoDispatchDropdown;
import com.excel.model.Dispatch_Header;
import com.excel.model.GenerateDispatchData;
import com.excel.model.GenerateDispatchDataCfaStock;
import com.excel.model.ManualDispatchList;
import com.excel.model.MonthList;
import com.excel.repository.DispatchRepository;
import com.excel.repository.LocationRepository;
import com.excel.repository.SystemParameterRepository;

@Service
public class DispatchServiceImpl implements DispatchService {
	
	@Autowired private DispatchRepository dispatchRepository;
	@Autowired private SystemParameterRepository systemParameterRepository;
	@Autowired private LocationRepository locationRepository;
	
	@Override
	public AllocationDetailList getAllocationDetailList(String emp_id) throws Exception {
		return dispatchRepository.getAllocationDetailList(emp_id);
	}

	@Override
	public List<MonthList> getMonthList(String tablename, String fieldlist, String search, String orderby)
			throws Exception {
		return dispatchRepository.getMonthList(tablename, fieldlist, search, orderby);
	}

	@Override
	public List<AutoDispatchDropdown> getAutoDispatchDropdown(String alloc_smp_id, String dispatchToLabel, String divId)
			throws Exception {
		return dispatchRepository.getAutoDispatchDropdown(alloc_smp_id, dispatchToLabel, divId);
	}
	
	@Override
	public List<GenerateDispatchData> generateDispatchData(DispatchBean bean)
			throws Exception {
		List<GenerateDispatchData> dispatchList = null; 
		Am_m_System_Parameter parameter = systemParameterRepository.getSpValueBySpName("Dsp_APPR_REQ").get(0);
		String pend_alloc="N";
		String sample_flag="";
		String direct_to_pso_ind = "N";
		boolean stock_at_cfa_ind = false;
		//long loc_link_dptloc_id = 0;
		
		if(bean.getDispatchType().equalsIgnoreCase("stkcfa")){
		    stock_at_cfa_ind = true;
		}
		if(bean.getDispatchType().equalsIgnoreCase("dtp")){
			direct_to_pso_ind = "Y";
			//loc_link_dptloc_id = locationRepository.getObjectById(bean.getLocId()).getLoc_link_dptloc_id();
		}
		System.err.println("bean.getDispatchTo()::"+bean.getDispatchTo());
		switch (bean.getDispatchTo()) {
		case "E"://Every One
			dispatchList=dispatchRepository.genAutoDispatch(bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					0l ,0l,0l,0l, pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "L"://Location
			dispatchList=dispatchRepository.genAutoDispatch(bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id(),Long.parseLong(bean.getSelect()),
					0l,0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "R"://Specified RBM
			dispatchList=dispatchRepository.genAutoDispatch( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					0l,Long.parseLong(bean.getSelect()),0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "S"://Specified State
			dispatchList=dispatchRepository.genAutoDispatch( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					0l,0l,Long.parseLong(bean.getSelect()),0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "A"://Specified ABM
			dispatchList=dispatchRepository.genAutoDispatch( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					Long.parseLong(bean.getSelect()),0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "M"://Specified MSR
			dispatchList=dispatchRepository.genAutoDispatch( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id(),0l,
					//0l,0l,0l,Long.parseLong(bean.getSelect()),pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
					0l,0l,0l,4372L,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
					break;
		case "SR"://Sample To RBM
			sample_flag="SR";
			dispatchList=dispatchRepository.genAutoDispatch( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					0l,0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),Long.parseLong(bean.getSelect()),0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "SA"://Sample To ABM
			sample_flag="SA";
			dispatchList=dispatchRepository.genAutoDispatch( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id(),0l,
					0l,0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,Long.parseLong(bean.getSelect()),sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "Z"://specified Zone
			dispatchList=dispatchRepository.genAutoDispatch( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id(),0l,
					0l,0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),Long.parseLong(bean.getSelect()),direct_to_pso_ind,stock_at_cfa_ind);
			break;
		}
		return dispatchList;
	}
	
	
	@Override
	public List<GenerateDispatchDataCfaStock> generateDispatchDataCfaStock(DispatchBean bean)
			throws Exception {
		List<GenerateDispatchDataCfaStock> dispatchList = null; 
		Am_m_System_Parameter parameter = systemParameterRepository.getSpValueBySpName("Dsp_APPR_REQ").get(0);
		String pend_alloc="N";
		String sample_flag="";
		String direct_to_pso_ind = "N";
		boolean stock_at_cfa_ind = false;
		//long loc_link_dptloc_id = 0;
		
		if(bean.getDispatchType().equalsIgnoreCase("stkcfa")){
		    stock_at_cfa_ind = true;
		}
		if(bean.getDispatchType().equalsIgnoreCase("dtp")){
			direct_to_pso_ind = "Y";
			//loc_link_dptloc_id = locationRepository.getObjectById(bean.getLocId()).getLoc_link_dptloc_id();
		}
		
		switch (bean.getDispatchTo()) {
		case "E"://Every One
			dispatchList=dispatchRepository.genAutoDispatchCfaStock(bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					0l ,0l,0l,0l, pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "L"://Location
			dispatchList=dispatchRepository.genAutoDispatchCfaStock(bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id(),Long.parseLong(bean.getSelect()),
					0l,0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "R"://Specified RBM
			dispatchList=dispatchRepository.genAutoDispatchCfaStock( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					0l,Long.parseLong(bean.getSelect()),0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "S"://Specified State
			dispatchList=dispatchRepository.genAutoDispatchCfaStock( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					0l,0l,Long.parseLong(bean.getSelect()),0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "A"://Specified ABM
			dispatchList=dispatchRepository.genAutoDispatchCfaStock( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					Long.parseLong(bean.getSelect()),0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "M"://Specified MSR
			dispatchList=dispatchRepository.genAutoDispatchCfaStock( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id(),0l,
					0l,0l,0l,Long.parseLong(bean.getSelect()),pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "SR"://Sample To RBM
			sample_flag="SR";
			dispatchList=dispatchRepository.genAutoDispatchCfaStock( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id() ,0l,
					0l,0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),Long.parseLong(bean.getSelect()),0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "SA"://Sample To ABM
			sample_flag="SA";
			dispatchList=dispatchRepository.genAutoDispatchCfaStock( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id(),0l,
					0l,0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,Long.parseLong(bean.getSelect()),sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),0l,direct_to_pso_ind,stock_at_cfa_ind);
			break;
		case "Z"://specified Zone
			dispatchList=dispatchRepository.genAutoDispatchCfaStock( bean.getCompanyCode(), bean.getAllocSmpYear() ,bean.getAllocPeriodCode() , bean.getLocId(),bean.getAlloc_smp_id(),0l,
					0l,0l,0l,0l,pend_alloc,bean.getAction(),bean.getEmpId(),0l,bean.getDivision(),0l,0l,sample_flag,bean.getChallanMsg(),Long.parseLong(bean.getMonth()),parameter.getSp_value(),Long.parseLong(bean.getSelect()),direct_to_pso_ind,stock_at_cfa_ind);
			break;
		}
		return dispatchList;
	}

	@Override
	public List<String> getAutoDispatchDetailsUpdated(Long smp_id, Long disp_cycle, Long loc_id, Long div_id,
			boolean stock_at_cfa_ind) throws Exception {
		return dispatchRepository.getAutoDispatchDetailsUpdated(smp_id, disp_cycle, loc_id, div_id, stock_at_cfa_ind);
	}

	@Override
	public List<ManualDispatchList> getDispatchListForApproval(String user_id, long sum_dsp_id) throws Exception {
		return dispatchRepository.getDispatchListForApproval(user_id, sum_dsp_id);
	}

	@Override
	public List<ManualDispatchList> getManualDispatchListApproval(String user_id, String user_type, Long sum_dsp_id)
			throws Exception {
		return dispatchRepository.getManualDispatchListApproval(user_id, user_type, sum_dsp_id);
	}
	
	
	//called from BPM after task complete - final approval
	@Override
	public void finalDispatchApproval(Long tran_id, String user_name, String company_cd,String task_status,String motivation) {
		//logic after final save
		System.out.println("Called from finalDispatchApproval:::::");
	}

	@Override
	public Dispatch_Header getDispatchHeaderById(Long dsp_id) throws Exception {
		return dispatchRepository.getDispatchHeaderById(dsp_id);
	}

	@Override
	public void updateHeaderForApproval(String status, Long tran_id, String user_name, Date appr_date)
			throws Exception {
		dispatchRepository.updateHeaderForApproval(status, tran_id, user_name, appr_date);
		
	}
	
}
